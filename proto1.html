<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MoodSync â€” Feel the Room</title>
<link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@300;400;700;900&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --pink:   #ff6b9d;
  --violet: #c77dff;
  --cyan:   #3ecfff;
  --lime:   #a8ff3e;
  --amber:  #ffd166;
}

html, body { height: 100%; overflow: hidden; }

body {
  font-family: 'DM Sans', sans-serif;
  background: #05050f;
  color: #f0f0ff;
  position: relative;
}

/* â”€â”€ CANVAS â”€â”€ */
#bgCanvas {
  position: fixed;
  inset: 0;
  z-index: 0;
  width: 100%;
  height: 100%;
}

/* scanlines */
body::after {
  content: '';
  position: fixed;
  inset: 0;
  background: repeating-linear-gradient(0deg, transparent, transparent 3px, rgba(0,0,0,0.05) 3px, rgba(0,0,0,0.05) 4px);
  pointer-events: none;
  z-index: 999;
}

/* â”€â”€ PAGES â”€â”€ */
.page {
  position: fixed;
  inset: 0;
  z-index: 10;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 2rem 1.5rem;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.55s ease;
}
.page.active { opacity: 1; pointer-events: all; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE 1 â€” LANDING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#pg-land { text-align: center; gap: 0; }

.logo-ring {
  width: 70px; height: 70px;
  border-radius: 50%;
  background: conic-gradient(from 0deg, var(--pink), var(--violet), var(--cyan), var(--lime), var(--amber), var(--pink));
  animation: spin 8s linear infinite;
  box-shadow: 0 0 50px rgba(199,125,255,0.5);
  margin: 0 auto 2rem;
  flex-shrink: 0;
}
@keyframes spin { to { transform: rotate(360deg); } }

.l-eye {
  font-size: 0.68rem;
  letter-spacing: 0.3em;
  color: rgba(255,255,255,0.35);
  text-transform: uppercase;
  margin-bottom: 1.2rem;
  animation: up 0.5s 0.1s both;
}

.l-title {
  font-family: 'Unbounded', sans-serif;
  font-size: clamp(3.2rem, 12vw, 7.5rem);
  font-weight: 900;
  line-height: 0.88;
  letter-spacing: -0.04em;
  margin-bottom: 1.8rem;
  animation: up 0.5s 0.2s both;
}

.l-title .g1 {
  display: block;
  background: linear-gradient(130deg, var(--pink) 0%, var(--violet) 45%, var(--cyan) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.l-title .g2 {
  display: block;
  color: transparent;
  -webkit-text-stroke: 1.5px rgba(255,255,255,0.22);
}

.l-desc {
  font-size: clamp(0.88rem, 2.5vw, 1.05rem);
  color: rgba(255,255,255,0.45);
  max-width: 430px;
  line-height: 1.85;
  margin: 0 auto 3rem;
  font-weight: 300;
  animation: up 0.5s 0.3s both;
}
.l-desc strong { color: rgba(255,255,255,0.82); font-weight: 500; }

/* THE BUTTON */
.big-btn {
  position: relative;
  border: none;
  background: none;
  cursor: pointer;
  animation: up 0.5s 0.4s both;
  outline: none;
}

.big-btn-glow {
  position: absolute;
  inset: -4px;
  border-radius: 999px;
  background: conic-gradient(from 0deg, var(--pink), var(--violet), var(--cyan), var(--lime), var(--amber), var(--pink));
  animation: spin 2.5s linear infinite;
  filter: blur(10px);
  opacity: 0.85;
}

.big-btn-face {
  position: relative;
  display: flex;
  align-items: center;
  gap: 0.9rem;
  background: #05050f;
  border-radius: 999px;
  padding: 1.15rem 2.8rem;
  font-family: 'Unbounded', sans-serif;
  font-size: clamp(0.8rem, 2.5vw, 0.95rem);
  font-weight: 700;
  letter-spacing: 0.07em;
  color: #fff;
  transition: transform 0.18s;
  white-space: nowrap;
}

.big-btn:hover .big-btn-face { transform: scale(1.04); }
.big-btn:active .big-btn-face { transform: scale(0.97); }

.mic-dot {
  width: 18px; height: 18px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--pink), var(--violet));
  position: relative;
  flex-shrink: 0;
}
.mic-dot::after {
  content: '';
  position: absolute;
  inset: -6px;
  border-radius: 50%;
  border: 1.5px solid rgba(255,107,157,0.55);
  animation: ripple 1.5s infinite;
}
@keyframes ripple { 0%{transform:scale(1);opacity:.8} 100%{transform:scale(2.2);opacity:0} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE 2 â€” RECORDING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#pg-rec { gap: 1.6rem; }

.rec-ring {
  position: relative;
  width: 148px; height: 148px;
}
.rec-ring svg { width: 100%; height: 100%; transform: rotate(-90deg); }
.track { fill: none; stroke: rgba(255,255,255,0.07); stroke-width: 5; }
.fill  { fill: none; stroke-width: 5; stroke-linecap: round; stroke-dasharray: 408; stroke-dashoffset: 0; transition: stroke-dashoffset .1s linear; }
.fill-grad { stop-color: var(--pink); }

.rec-num {
  position: absolute; inset: 0;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Unbounded', sans-serif;
  font-size: 3rem; font-weight: 900; letter-spacing: -0.06em;
}

.rec-cam-wrap {
  position: relative;
  width: min(300px, 88vw);
  aspect-ratio: 4/3;
  border-radius: 1.4rem;
  overflow: hidden;
  border: 1.5px solid rgba(255,255,255,0.1);
  box-shadow: 0 0 50px rgba(199,125,255,0.2);
}
#vidPrev { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); display: block; }
.cam-overlay {
  position: absolute; inset: 0;
  background: linear-gradient(to top, rgba(5,5,15,0.75) 0%, transparent 55%);
  display: flex; align-items: flex-end; padding: 1rem;
}
.rec-pill {
  display: flex; align-items: center; gap: 0.5rem;
  background: rgba(255,255,255,0.08);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 999px;
  padding: 0.35rem 0.9rem;
  font-size: 0.78rem; font-weight: 500;
}
.rdot { width: 7px; height: 7px; border-radius: 50%; background: #ff4040; animation: blink .7s infinite; box-shadow: 0 0 8px #ff4040; }
@keyframes blink { 50% { opacity: .15; } }

.vol-strip {
  display: flex; gap: 3px; align-items: flex-end; height: 28px;
}
.vb { width: 5px; border-radius: 3px; background: linear-gradient(to top, var(--pink), var(--violet)); min-height: 4px; }

.rec-hint { font-size: 0.8rem; color: rgba(255,255,255,0.35); letter-spacing: 0.1em; text-transform: uppercase; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE 3 â€” ANALYZING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#pg-analyze { gap: 1.8rem; text-align: center; }

.orb {
  width: 110px; height: 110px;
  border-radius: 50%;
  animation: breathe 1.4s ease-in-out infinite;
}
@keyframes breathe {
  0%,100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

.az-title { font-family: 'Unbounded', sans-serif; font-size: 1.25rem; font-weight: 700; letter-spacing: -0.02em; }

.az-steps { display: flex; flex-direction: column; gap: 0.55rem; width: min(300px, 88vw); text-align: left; }

.az-step {
  display: flex; align-items: center; gap: 0.7rem;
  padding: 0.7rem 0.9rem;
  border-radius: 0.7rem;
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.06);
  font-size: 0.83rem;
  color: rgba(255,255,255,0.32);
  transition: all 0.35s ease;
}
.az-step.on {
  color: rgba(255,255,255,0.85);
  border-color: rgba(255,255,255,0.14);
  background: rgba(255,255,255,0.07);
}
.step-num {
  width: 22px; height: 22px;
  border-radius: 50%;
  border: 1.5px solid rgba(255,255,255,0.18);
  display: flex; align-items: center; justify-content: center;
  font-size: 0.66rem; flex-shrink: 0;
  transition: all 0.35s;
}
.az-step.on .step-num {
  background: linear-gradient(135deg, var(--lime), var(--cyan));
  border-color: transparent;
  color: #000; font-weight: 900;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE 4 â€” SIMULATOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#pg-sim {
  justify-content: flex-start;
  overflow-y: auto;
  padding: 1.2rem 1.5rem 3rem;
  gap: 0;
}
#pg-sim::-webkit-scrollbar { width: 3px; }
#pg-sim::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 2px; }

.sim-nav {
  width: 100%; max-width: 580px;
  margin: 0 auto 1.2rem;
  display: flex; align-items: center; justify-content: space-between;
}
.back-btn {
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.1);
  color: rgba(255,255,255,0.55);
  border-radius: 999px;
  padding: 0.4rem 1rem;
  font-size: 0.75rem;
  cursor: pointer;
  font-family: 'DM Sans', sans-serif;
  transition: all 0.2s;
}
.back-btn:hover { background: rgba(255,255,255,0.11); color: #fff; }
.sim-wordmark {
  font-family: 'Unbounded', sans-serif;
  font-size: 0.8rem; font-weight: 700;
  background: linear-gradient(90deg, var(--pink), var(--violet));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}

/* RESULT CARD */
.res-card {
  width: 100%; max-width: 580px;
  margin: 0 auto 1.1rem;
  border-radius: 1.4rem;
  padding: 1.8rem;
  text-align: center;
  position: relative;
  overflow: hidden;
  border: 1px solid rgba(255,255,255,0.1);
  background: rgba(255,255,255,0.03);
}
.res-card-bg { position: absolute; inset: 0; opacity: 0.12; transition: background 0.8s; }
.res-emoji { font-size: 3.5rem; margin-bottom: 0.5rem; position: relative; }
.res-name {
  font-family: 'Unbounded', sans-serif;
  font-size: clamp(1.3rem, 5vw, 2rem);
  font-weight: 900; letter-spacing: -0.03em;
  margin-bottom: 0.5rem; position: relative;
}
.res-desc {
  font-size: 0.88rem;
  color: rgba(255,255,255,0.5);
  max-width: 340px; margin: 0 auto;
  line-height: 1.75; position: relative;
}

/* ROOM CANVAS */
.room-wrap {
  width: 100%; max-width: 580px;
  margin: 0 auto 1.1rem;
}
.room-label {
  font-size: 0.63rem; letter-spacing: 0.22em;
  text-transform: uppercase; color: rgba(255,255,255,0.28);
  margin-bottom: 0.6rem;
}
.room-svg-box {
  border-radius: 1.2rem; overflow: hidden;
  border: 1px solid rgba(255,255,255,0.07);
}

/* STATS */
.stats-row {
  width: 100%; max-width: 580px;
  margin: 0 auto 1.1rem;
  display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.65rem;
}
.stat {
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.07);
  border-radius: 1rem;
  padding: 0.9rem; text-align: center;
}
.sv {
  font-family: 'Unbounded', sans-serif;
  font-size: 1.4rem; font-weight: 900;
  letter-spacing: -0.04em; margin-bottom: 0.2rem;
}
.sk { font-size: 0.6rem; letter-spacing: 0.12em; text-transform: uppercase; color: rgba(255,255,255,0.32); }

/* BULBS */
.bulbs-row {
  width: 100%; max-width: 580px;
  margin: 0 auto;
}
.bulbs-strip { display: flex; gap: 0.65rem; justify-content: center; margin-top: 0.6rem; }
.bulb {
  width: 48px; height: 68px;
  border-radius: 50% 50% 28% 28% / 58% 58% 42% 42%;
  transition: background 0.6s, box-shadow 0.6s;
  position: relative;
  flex-shrink: 0;
}
.bulb::after {
  content: '';
  position: absolute; bottom: -7px;
  left: 50%; transform: translateX(-50%);
  width: 20px; height: 9px;
  background: rgba(255,255,255,0.1); border-radius: 2px;
}

/* UTIL */
@keyframes up { from{opacity:0;transform:translateY(22px)} to{opacity:1;transform:translateY(0)} }

@media (max-width: 420px) {
  .stats-row { grid-template-columns: 1fr 1fr; }
  .big-btn-face { padding: 1rem 2rem; }
}
</style>
</head>
<body>

<canvas id="bgCanvas"></canvas>

<!-- â•â•â• PAGE 1: LANDING â•â•â• -->
<div class="page active" id="pg-land">
  <div class="logo-ring"></div>
  <p class="l-eye">AI-Powered Environment Intelligence</p>
  <h1 class="l-title">
    <span class="g1">MoodSync</span>
    <span class="g2">LIGHTS</span>
  </h1>
  <p class="l-desc">
    Your room has a vibe â€” <strong>now your lights feel it.</strong><br>
    We listen and watch your space for 5 seconds, detect the mood, and instantly transform your lighting to match. <strong>No switches. Just atmosphere.</strong>
  </p>
  <button class="big-btn" onclick="beginRecord()">
    <div class="big-btn-glow"></div>
    <div class="big-btn-face">
      <div class="mic-dot"></div>
      ANALYZE ENVIRONMENT
    </div>
  </button>
</div>

<!-- â•â•â• PAGE 2: RECORDING â•â•â• -->
<div class="page" id="pg-rec">
  <div class="rec-ring">
    <svg viewBox="0 0 148 148">
      <defs>
        <linearGradient id="tg" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="#ff6b9d"/>
          <stop offset="50%" stop-color="#c77dff"/>
          <stop offset="100%" stop-color="#3ecfff"/>
        </linearGradient>
      </defs>
      <circle class="track" cx="74" cy="74" r="65"/>
      <circle class="fill" id="tFill" cx="74" cy="74" r="65" stroke="url(#tg)"/>
    </svg>
    <div class="rec-num" id="tNum">5</div>
  </div>

  <div class="vol-strip" id="volStrip">
    <div class="vb" style="height:6px"></div><div class="vb" style="height:12px"></div>
    <div class="vb" style="height:20px"></div><div class="vb" style="height:14px"></div>
    <div class="vb" style="height:8px"></div><div class="vb" style="height:18px"></div>
    <div class="vb" style="height:10px"></div><div class="vb" style="height:22px"></div>
    <div class="vb" style="height:12px"></div><div class="vb" style="height:16px"></div>
    <div class="vb" style="height:8px"></div><div class="vb" style="height:20px"></div>
  </div>

  <div class="rec-cam-wrap">
    <video id="vidPrev" autoplay muted playsinline></video>
    <div class="cam-overlay">
      <div class="rec-pill"><div class="rdot"></div> Analyzingâ€¦</div>
    </div>
  </div>

  <p class="rec-hint">Listening to your space</p>
</div>

<!-- â•â•â• PAGE 3: ANALYZING â•â•â• -->
<div class="page" id="pg-analyze">
  <div class="orb" id="azOrb"></div>
  <div class="az-title">Reading the roomâ€¦</div>
  <div class="az-steps">
    <div class="az-step" id="s1"><div class="step-num">1</div> Processing audio signals</div>
    <div class="az-step" id="s2"><div class="step-num">2</div> Scanning facial expressions</div>
    <div class="az-step" id="s3"><div class="step-num">3</div> Detecting mood pattern</div>
    <div class="az-step" id="s4"><div class="step-num">4</div> Calibrating light response</div>
  </div>
</div>

<!-- â•â•â• PAGE 4: SIMULATOR â•â•â• -->
<div class="page" id="pg-sim">
  <div class="sim-nav">
    <button class="back-btn" onclick="goHome()">â† Analyze Again</button>
    <div class="sim-wordmark">MoodSync</div>
    <div style="width:100px"></div>
  </div>

  <div class="res-card" id="resCard">
    <div class="res-card-bg" id="resBg"></div>
    <div class="res-emoji" id="resEmoji">ğŸ˜‚</div>
    <div class="res-name" id="resName">LAUGHTER</div>
    <div class="res-desc" id="resDesc">Laughter detected! Disco mode activated.</div>
  </div>

  <div class="room-wrap">
    <div class="room-label">Live Light Simulator</div>
    <div class="room-svg-box">
      <svg id="roomSVG" viewBox="0 0 580 240" xmlns="http://www.w3.org/2000/svg" style="width:100%;display:block;">
        <defs>
          <radialGradient id="rAmb" cx="50%" cy="0%" r="75%">
            <stop id="ambS" offset="0%" stop-color="#ffffff" stop-opacity="0.12"/>
            <stop offset="100%" stop-color="#000" stop-opacity="0"/>
          </radialGradient>
        </defs>
        <!-- walls -->
        <rect width="580" height="240" fill="#080818"/>
        <rect y="190" width="580" height="50" fill="#0b0b1e"/>
        <rect y="187" width="580" height="4" fill="rgba(255,255,255,0.05)"/>
        <!-- ambient ceiling glow -->
        <rect width="580" height="240" fill="url(#rAmb)"/>
        <!-- cords -->
        <line x1="145" y1="0" x2="145" y2="26" stroke="rgba(255,255,255,0.18)" stroke-width="1.5"/>
        <line x1="290" y1="0" x2="290" y2="26" stroke="rgba(255,255,255,0.18)" stroke-width="1.5"/>
        <line x1="435" y1="0" x2="435" y2="26" stroke="rgba(255,255,255,0.18)" stroke-width="1.5"/>
        <!-- light cones -->
        <ellipse id="c0" cx="145" cy="36" rx="130" ry="170" fill="rgba(255,255,255,0)" opacity="0.38"/>
        <ellipse id="c1" cx="290" cy="36" rx="130" ry="170" fill="rgba(255,255,255,0)" opacity="0.38"/>
        <ellipse id="c2" cx="435" cy="36" rx="130" ry="170" fill="rgba(255,255,255,0)" opacity="0.38"/>
        <!-- floor pools -->
        <ellipse id="p0" cx="145" cy="204" rx="88" ry="16" fill="rgba(255,255,255,0)" opacity="0.5"/>
        <ellipse id="p1" cx="290" cy="204" rx="88" ry="16" fill="rgba(255,255,255,0)" opacity="0.5"/>
        <ellipse id="p2" cx="435" cy="204" rx="88" ry="16" fill="rgba(255,255,255,0)" opacity="0.5"/>
        <!-- holders -->
        <rect x="137" y="24" width="16" height="10" rx="3" fill="#1a1a30"/>
        <rect x="282" y="24" width="16" height="10" rx="3" fill="#1a1a30"/>
        <rect x="427" y="24" width="16" height="10" rx="3" fill="#1a1a30"/>
        <!-- bulbs -->
        <circle id="b0" cx="145" cy="34" r="16" fill="#fff"/>
        <circle id="b1" cx="290" cy="34" r="16" fill="#fff"/>
        <circle id="b2" cx="435" cy="34" r="16" fill="#fff"/>
        <!-- sofa -->
        <rect x="40" y="162" width="170" height="28" rx="6" fill="rgba(255,255,255,0.035)" stroke="rgba(255,255,255,0.06)" stroke-width="1"/>
        <rect x="40" y="146" width="170" height="20" rx="5" fill="rgba(255,255,255,0.025)" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
        <rect x="40" y="146" width="18" height="44" rx="5" fill="rgba(255,255,255,0.025)"/>
        <rect x="192" y="146" width="18" height="44" rx="5" fill="rgba(255,255,255,0.025)"/>
        <!-- table -->
        <rect x="252" y="178" width="76" height="14" rx="3" fill="rgba(255,255,255,0.05)" stroke="rgba(255,255,255,0.07)" stroke-width="1"/>
        <rect x="258" y="192" width="4" height="12" fill="rgba(255,255,255,0.04)"/>
        <rect x="320" y="192" width="4" height="12" fill="rgba(255,255,255,0.04)"/>
        <!-- lamp / plant -->
        <ellipse cx="510" cy="182" rx="18" ry="22" fill="rgba(255,255,255,0.04)" stroke="rgba(255,255,255,0.06)" stroke-width="1"/>
        <rect x="505" y="195" width="10" height="10" rx="2" fill="rgba(255,255,255,0.06)"/>
      </svg>
    </div>
  </div>

  <div class="stats-row">
    <div class="stat"><div class="sv" id="svDb">â€”</div><div class="sk">Volume dB</div></div>
    <div class="stat"><div class="sv" id="svConf">â€”</div><div class="sk">Confidence</div></div>
    <div class="stat"><div class="sv" id="svCol">â€”</div><div class="sk">Light Mode</div></div>
  </div>

  <div class="bulbs-row">
    <div class="room-label">Bulb Status</div>
    <div class="bulbs-strip">
      <div class="bulb" id="lb0"></div>
      <div class="bulb" id="lb1"></div>
      <div class="bulb" id="lb2"></div>
      <div class="bulb" id="lb3"></div>
      <div class="bulb" id="lb4"></div>
    </div>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BG CANVAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const bgCv = document.getElementById('bgCanvas');
const bgX = bgCv.getContext('2d');
let BW, BH, blobs;
const BC = ['#ff6b9d','#c77dff','#3ecfff','#a8ff3e','#ffd166'];

function initBg() {
  BW = bgCv.width = window.innerWidth;
  BH = bgCv.height = window.innerHeight;
  blobs = BC.map(c => ({
    x: Math.random()*BW, y: Math.random()*BH,
    vx: (Math.random()-.5)*.55, vy: (Math.random()-.5)*.55,
    r: 220+Math.random()*260, color: c,
    a: .05+Math.random()*.055
  }));
}

function drawBg() {
  bgX.fillStyle = '#05050f'; bgX.fillRect(0,0,BW,BH);
  for (const b of blobs) {
    b.x += b.vx; b.y += b.vy;
    if(b.x<-b.r)b.x=BW+b.r; if(b.x>BW+b.r)b.x=-b.r;
    if(b.y<-b.r)b.y=BH+b.r; if(b.y>BH+b.r)b.y=-b.r;
    const g=bgX.createRadialGradient(b.x,b.y,0,b.x,b.y,b.r);
    g.addColorStop(0,b.color+Math.round(b.a*255).toString(16).padStart(2,'0'));
    g.addColorStop(1,'transparent');
    bgX.fillStyle=g; bgX.beginPath(); bgX.arc(b.x,b.y,b.r,0,Math.PI*2); bgX.fill();
  }
  bgX.strokeStyle='rgba(255,255,255,0.018)'; bgX.lineWidth=1;
  for(let x=0;x<BW;x+=52){bgX.beginPath();bgX.moveTo(x,0);bgX.lineTo(x,BH);bgX.stroke();}
  for(let y=0;y<BH;y+=52){bgX.beginPath();bgX.moveTo(0,y);bgX.lineTo(BW,y);bgX.stroke();}
  requestAnimationFrame(drawBg);
}
window.addEventListener('resize', initBg);
initBg(); drawBg();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOOD DEFINITIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const MOODS = {
  angry: {
    name:'TENSION / ANGER', emoji:'ğŸ˜¤',
    desc:'High-tension audio detected. Lights have shifted to soothing blue to gently de-escalate the energy in the room.',
    color:'#3ecfff', colorLabel:'Calm Blue',
    bg:'radial-gradient(ellipse at top,#001a2e,#000814)',
    shadow:'rgba(62,207,255,0.45)',
    lightFn: t => .62+.14*Math.sin(t*.75),
    bulbFx: (t,i) => .65+.14*Math.sin(t*.75+i*.4),
    discoMode: false
  },
  laugh: {
    name:'LAUGHTER / JOY', emoji:'ğŸ˜‚',
    desc:'Laughter and happiness detected! Lights are pulsing to the rhythm of your joy in full disco mode.',
    color:'#a8ff3e', colorLabel:'Disco Lime',
    bg:'radial-gradient(ellipse at top,#0d1f00,#050f00)',
    shadow:'rgba(168,255,62,0.45)',
    lightFn: t => .5+.5*Math.abs(Math.sin(t*3.2)),
    bulbFx: (t,i) => .45+.55*Math.abs(Math.sin(t*3.5+i*1.1)),
    discoMode: false
  },
  calm: {
    name:'CALM / RELAXED', emoji:'ğŸ˜Œ',
    desc:'Peaceful energy detected. A warm, amber glow fills the room with cozy comfort.',
    color:'#ffd166', colorLabel:'Warm Amber',
    bg:'radial-gradient(ellipse at top,#1a1200,#0a0800)',
    shadow:'rgba(255,209,102,0.45)',
    lightFn: t => .82+.07*Math.sin(t*.28),
    bulbFx: (t,i) => .82+.07*Math.sin(t*.28+i*.2),
    discoMode: false
  },
  focus: {
    name:'FOCUS / DEEP WORK', emoji:'ğŸ§ ',
    desc:'Quiet concentration detected. Pure, steady cool white for maximum mental clarity.',
    color:'#c77dff', colorLabel:'Cool White',
    bg:'radial-gradient(ellipse at top,#0d0018,#050008)',
    shadow:'rgba(199,125,255,0.45)',
    lightFn: t => .95,
    bulbFx: (t,i) => .95,
    discoMode: false
  },
  party: {
    name:'PARTY ENERGY', emoji:'ğŸ‰',
    desc:'Massive energy and multiple voices detected! Full RGB cycling â€” your room is officially a disco.',
    color:'#ff6b9d', colorLabel:'RGB Disco',
    bg:'radial-gradient(ellipse at top,#1a0010,#080006)',
    shadow:'rgba(255,107,157,0.45)',
    lightFn: t => .6+.4*Math.sin(t*5),
    bulbFx: (t,i) => .55+.45*Math.sin(t*5+i*1.4),
    discoMode: true
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let stream=null, actx=null, analyser=null;
let volIv=null, cntIv=null;
let samples=[];
let detMood=null;
let rafId=null;
let simT0=null;
let discoHue=0;
let curMood=null;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function show(id) {
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RECORDING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function beginRecord() {
  show('pg-rec');
  samples = [];

  try {
    stream = await navigator.mediaDevices.getUserMedia({ video:true, audio:true });
    document.getElementById('vidPrev').srcObject = stream;

    actx = new (window.AudioContext||window.webkitAudioContext)();
    const src = actx.createMediaStreamSource(stream);
    analyser = actx.createAnalyser();
    analyser.fftSize = 256;
    src.connect(analyser);
    const buf = new Uint8Array(analyser.frequencyBinCount);

    const vbars = document.querySelectorAll('.vb');
    volIv = setInterval(()=>{
      analyser.getByteFrequencyData(buf);
      const avg = buf.reduce((a,b)=>a+b,0)/buf.length;
      samples.push(avg);
      vbars.forEach(b=>{ b.style.height=Math.min(4+Math.random()*(avg*.35),27)+'px'; });
    }, 60);

  } catch(e) {
    // Demo mode â€” simulate audio data
    document.getElementById('vidPrev').style.background = '#0d0d20';
    const vbars = document.querySelectorAll('.vb');
    volIv = setInterval(()=>{
      const fake = 25 + Math.random()*90;
      samples.push(fake);
      vbars.forEach(b=>{ b.style.height=Math.min(4+Math.random()*(fake*.35),27)+'px'; });
    }, 60);
  }

  // Countdown 5 â†’ 0
  let rem = 5;
  const circ = 408; // 2Ï€Ã—65
  const fill = document.getElementById('tFill');
  const num  = document.getElementById('tNum');
  fill.style.strokeDashoffset = 0;

  cntIv = setInterval(()=>{
    rem -= .08;
    fill.style.strokeDashoffset = circ * (rem/5);
    num.textContent = Math.ceil(Math.max(rem,0));
    if (rem <= 0) {
      clearInterval(cntIv);
      clearInterval(volIv);
      endRecord();
    }
  }, 80);
}

function endRecord() {
  if(stream){ stream.getTracks().forEach(t=>t.stop()); stream=null; }
  if(actx){ actx.close(); actx=null; }

  // Classify from real audio
  const avg = samples.length ? samples.reduce((a,b)=>a+b)/samples.length : 40;
  const mx  = samples.length ? Math.max(...samples) : 60;
  const vari = samples.length ? samples.reduce((s,v)=>s+Math.pow(v-avg,2),0)/samples.length : 300;

  if      (mx > 160 && vari > 900)  detMood = 'angry';
  else if (vari > 700 && avg > 65)  detMood = 'party';
  else if (vari > 400 && avg > 48)  detMood = 'laugh';
  else if (avg < 32)                detMood = 'focus';
  else                              detMood = 'calm';

  runAnalyze(avg, mx);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANALYZE PHASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function runAnalyze(avg, mx) {
  show('pg-analyze');
  const m = MOODS[detMood];

  const orb = document.getElementById('azOrb');
  orb.style.background = `radial-gradient(circle at 35% 35%, #fff4, transparent 60%), radial-gradient(circle, ${m.color}, ${m.color}88)`;
  orb.style.boxShadow = `0 0 60px ${m.shadow}`;

  // Reset steps
  ['s1','s2','s3','s4'].forEach((id,i)=>{
    const el=document.getElementById(id);
    el.classList.remove('on');
    el.querySelector('.step-num').textContent=i+1;
  });

  const delays=[500,1050,1700,2300];
  ['s1','s2','s3','s4'].forEach((id,i)=>{
    setTimeout(()=>{
      const el=document.getElementById(id);
      el.classList.add('on');
      el.querySelector('.step-num').textContent='âœ“';
    }, delays[i]);
  });

  setTimeout(()=>showSim(avg,mx), 3100);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIMULATOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showSim(avg, mx) {
  show('pg-sim');
  const m = MOODS[detMood];
  curMood = m;

  // Result card
  document.getElementById('resEmoji').textContent = m.emoji;
  document.getElementById('resName').textContent  = m.name;
  document.getElementById('resName').style.color  = m.color;
  document.getElementById('resDesc').textContent  = m.desc;
  document.getElementById('resBg').style.background = m.bg;
  document.getElementById('resCard').style.borderColor = m.color+'44';
  document.getElementById('resCard').style.boxShadow = `0 0 60px ${m.color}22`;

  // Stats
  const db = Math.round(20*Math.log10(avg+1));
  const conf = Math.round(73+Math.random()*22);
  document.getElementById('svDb').textContent = db;
  document.getElementById('svDb').style.color = m.color;
  document.getElementById('svConf').textContent = conf+'%';
  document.getElementById('svConf').style.color = m.color;
  document.getElementById('svCol').textContent = m.colorLabel.split(' ')[0];
  document.getElementById('svCol').style.color = m.color;

  // Init bulbs
  if (!m.discoMode) {
    for(let i=0;i<5;i++){
      const lb=document.getElementById('lb'+i);
      lb.style.background=m.color;
      lb.style.boxShadow=`0 0 20px ${m.color}99, 0 0 40px ${m.color}44`;
    }
  }

  // Start animation
  if(rafId) cancelAnimationFrame(rafId);
  discoHue=0; simT0=performance.now();
  animateSim();
}

function animateSim() {
  const m = curMood;
  if(!m){ return; }
  const t = (performance.now()-simT0)/1000;

  let mainCol = m.color;
  const intensity = m.lightFn(t);

  if(m.discoMode) {
    discoHue=(discoHue+1.8)%360;
    // Per-bulb hue offset in SVG
    ['b0','b1','b2'].forEach((id,i)=>{
      const h=(discoHue+i*120)%360;
      const hc=hslHex(h,100,62);
      const el=document.getElementById(id);
      if(el){ el.setAttribute('fill',hc); el.style.filter=`drop-shadow(0 0 ${10*intensity}px ${hc})`; }
    });
    ['c0','c1','c2'].forEach((id,i)=>{
      const h=(discoHue+i*120)%360;
      const hc=hslHex(h,100,62);
      const el=document.getElementById(id);
      if(el) el.style.fill=hexRgba(hc,.28*intensity);
    });
    ['p0','p1','p2'].forEach((id,i)=>{
      const h=(discoHue+i*120)%360;
      const hc=hslHex(h,100,62);
      const el=document.getElementById(id);
      if(el) el.style.fill=hexRgba(hc,.35*intensity);
    });
    // Strip bulbs
    for(let i=0;i<5;i++){
      const h=(discoHue+i*72)%360;
      const hc=hslHex(h,100,62);
      const lb=document.getElementById('lb'+i);
      const bi=m.bulbFx(t,i);
      if(lb){ lb.style.background=hc; lb.style.boxShadow=`0 0 ${20*bi}px ${hc}cc`; lb.style.opacity=bi; }
    }
    mainCol = hslHex(discoHue,100,62);
  } else {
    ['b0','b1','b2'].forEach(id=>{
      const el=document.getElementById(id);
      if(el){ el.setAttribute('fill',mainCol); el.style.filter=`drop-shadow(0 0 ${12*intensity}px ${mainCol})`; }
    });
    ['c0','c1','c2'].forEach(id=>{
      const el=document.getElementById(id);
      if(el) el.style.fill=hexRgba(mainCol,.3*intensity);
    });
    ['p0','p1','p2'].forEach(id=>{
      const el=document.getElementById(id);
      if(el) el.style.fill=hexRgba(mainCol,.38*intensity);
    });
    // Strip
    for(let i=0;i<5;i++){
      const bi=m.bulbFx(t,i);
      const lb=document.getElementById('lb'+i);
      if(lb){ lb.style.opacity=bi; lb.style.boxShadow=`0 0 ${22*bi}px ${mainCol}cc, 0 0 ${44*bi}px ${mainCol}55`; }
    }
  }

  // Ambient ceiling stop
  const as=document.getElementById('ambS');
  if(as){ as.setAttribute('stop-color',mainCol); as.setAttribute('stop-opacity',(intensity*.18).toFixed(2)); }

  rafId=requestAnimationFrame(animateSim);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COLOR UTILS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function hslHex(h,s,l){
  s/=100; l/=100;
  const a=s*Math.min(l,1-l);
  const f=n=>{const k=(n+h/30)%12; return Math.round((l-a*Math.max(Math.min(k-3,9-k,1),-1))*255);};
  return '#'+[f(0),f(8),f(4)].map(v=>v.toString(16).padStart(2,'0')).join('');
}

function hexRgba(hex,a){
  const r=parseInt(hex.slice(1,3),16);
  const g=parseInt(hex.slice(3,5),16);
  const b=parseInt(hex.slice(5,7),16);
  return `rgba(${r},${g},${b},${a.toFixed(2)})`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function goHome(){
  if(rafId){cancelAnimationFrame(rafId);rafId=null;}
  curMood=null; discoHue=0;
  // reset SVG
  ['b0','b1','b2'].forEach(id=>{const e=document.getElementById(id);if(e){e.setAttribute('fill','#fff');e.style.filter='';}});
  ['c0','c1','c2','p0','p1','p2'].forEach(id=>{const e=document.getElementById(id);if(e)e.style.fill='rgba(255,255,255,0)';});
  show('pg-land');
}
</script>
</body>
</html>